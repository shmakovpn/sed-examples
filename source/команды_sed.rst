Комманды sed
============

 .. epigraph::

  БДСМ - база данный системы мониторинга

Введите *man sed* и попробуйте что либо понять.

Ощутили, что лирикой слов точно и просто передать поведение программы,
а именно, то как она оперирует стандарным вводом, стандартным выводом,
буферами, ветвлениями, переходами и всем остальным, задача отнюдь не
тривиальная, и это мягко говоря.

Не зря физика использует язык математики, в музыке ноты, а в геометрии аксиомы и теоремы.

Операции языка **perl** более близки к человеку чем, комманды **sed**.

Эта глава, объясняет поведение команд **sed** куда более человеческим языком.

+------------+-----------------------+------------------------------------+
| sed        | perl                  | Описание                           |
+============+=======================+====================================+
| {}         | .. code-block:: perl  | Начало и окончания блока комманд   |
|            |                       |                                    |
|            |  {}                   |                                    |
|            |                       |                                    |
+------------+-----------------------+------------------------------------+
| b label    | .. code-block:: perl  | Безусловный переход на метку label |
|            |                       |                                    |
|            |  goto label;          |                                    |
|            |                       |                                    |
+------------+-----------------------+------------------------------------+
| b          | .. code-block:: perl  | Переход на слудующую итерацию      |
|            |                       |                                    |
|            |  next;                |                                    |
|            |                       |                                    |
+------------+-----------------------+------------------------------------+
| c text     | .. code-block:: perl  | Вывод text, вместо строки.         |
|            |                       | Выполните, посмотрите, что будет.  |
|            |  print("text");       |                                    |
|            |  next;                | .. code-block:: bash               |
|            |                       |                                    |
|            |                       |  cat one-ten.txt | sed -nre '3cGO' |
|            |                       |                                    |
+------------+-----------------------+------------------------------------+
| d          | .. code-block:: perl  | Очищает "pattern space" и          |
|            |                       | переходит к следущей интерации     |
|            |  $ps="";              |                                    |
|            |  next;                |                                    |
+------------+-----------------------+------------------------------------+
| D          | .. code-block:: perl  | Если "pattern space", не содержит  |
|            |                       | перевод строки, выполним команду d.|
|            |  L: if($ps!~"\n"){    | Иначе, вырежем из "pattern space", |
|            |      $ps="";          | текст до перевода строки           |
|            |      next;            | влючительно, и запустим цикл       |
|            |  } else {             | повторно с новым значением         |
|            |      $ps=~s/^.*\n//;  | "pattern space"                    |
|            |      goto L;          |                                    |
|            |  }                    |                                    |
+------------+-----------------------+------------------------------------+
| h          | .. code-block:: perl  | Копирует "pattern space" в         |
|            |                       | "hold space"                       |
|            |  $hs=$ps;             |                                    |
|            |                       |                                    |
+------------+-----------------------+------------------------------------+
| H          | .. code-block:: perl  | Добавляет перевод строки к         |
|            |                       | "hold space", затем добавляет      |
|            |  $hs.="\n".$ps;       | "pattern space"                    |
|            |                       |                                    |
+------------+-----------------------+------------------------------------+
| g          | .. code-block:: perl  | Копиреут "hold space" в            |
|            |                       | "pattern space"                    |
|            |  $ps=$hs;             |                                    |
|            |                       |                                    |
+------------+-----------------------+------------------------------------+
| G          | .. code-block:: perl  | Добавляет перевод строки к         |
|            |                       | "pattern space", затем добавляет   |
|            |  $ps.="\n".$hs;       | "hold space"                       |
+------------+-----------------------+------------------------------------+
| n          | .. code-block:: perl  | Считывает следующую строку со      |
|            |                       | стандартного ввода в               |
|            |  $ps=<>;              | "pattern space"                    |
|            |                       |                                    |
+------------+-----------------------+------------------------------------+
| N          | .. code-block:: perl  | Добаляет перевод строки к          |
|            |                       | "pattern space". Затем считывает   |
|            |  $ps.="\n".<> or next;| следующую строку со стандартного   |
|            |  chomp($ps);          | ввода. Если строк больше нет       |
|            |                       | прекращает выполнение комманд      |
+------------+-----------------------+------------------------------------+
| p          | .. code-block:: perl  | Вывод "pattern space" на stdout    |
|            |                       | с добавлением перевода строки      |
|            |  print($ps."\n");     |                                    |
|            |                       |                                    |
+------------+-----------------------+------------------------------------+
| P          | .. code-block:: perl  | Вывод "pattern space" до первого   |
|            |                       | перевода строки на стандартный     |
|            |  say((split(/\n))[0]) | вывод с добавлением перевода строки|
|            |                       |                                    |
+------------+-----------------------+------------------------------------+
| s/p/R/     | .. code-block:: perl  | Поиск по паттерну p и замена на    |
|            |                       | R. Практически полный аналог       |
|            |  $ps=~s/p/R/;         | операции замены в perl. Так же     |
|            |                       | работают модификаторы i и g.       |
|            |                       | Специальный символ "&" в R         |
|            |                       | заменяется на текст из             |
|            |                       | "pattern space" подпавший под      |
|            |                       | паттерн p. В perl это "$&". \\1-\\9|
|            |                       | в perl будут $1-$9.                |
+------------+-----------------------+------------------------------------+
| t label    | .. code-block:: perl  | Условный переход. Выполняется если |
|            |                       | операция s/// выполнила замену.    |
|            |  $t=($ps=~s/p/R/);    |                                    |
|            |  goto label if $t;    |                                    |
|            |                       |                                    |
+------------+-----------------------+------------------------------------+
| t          | .. code-block:: perl  | Условный переход на следующий цикл |
|            |                       | при успешном выполнении s///       |
|            |  $t=($ps=~s/p/R/);    |                                    |
|            |  next if $t;          |                                    |
+------------+-----------------------+------------------------------------+
| T label    | .. code-block:: perl  | Условный переход. Выполняется если |
|            |                       | операция s/// не выполнила замену. |
|            |  $t=($ps=~s/p/R/);    |                                    |
|            |  goto label if !$t;   |                                    |
|            |                       |                                    |
+------------+-----------------------+------------------------------------+
| T          | .. code-block:: perl  | Условный переход на следующий цикл |
|            |                       | при не успешном выполнении s///    |
|            |  $t=($ps=~s/p/R/);    |                                    |
|            |  next if !$t;         |                                    |
+------------+-----------------------+------------------------------------+
| x          | .. code-block:: perl  | Обмен содержимым между "hold space"|
|            |                       | и "pattern space"                  |
|            |  ($ps,$hs)=($hs,$ps); |                                    |
+------------+-----------------------+------------------------------------+
| y/from/to/ | .. code-block:: perl  | Тоже самое что y/// в perl, символы|
|            |                       | из from будут заменены на          |
|            |  $ps=~y/from/to/      | соответствующие символы из to      |
+------------+-----------------------+------------------------------------+

Я сознательно опустил команду *l*. Т.к. не нашел ее полезной для себя.